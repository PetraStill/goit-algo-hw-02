"""
Ця програма визначає, чи є введений користувачем рядок паліндромом.

Перед перевіркою текст нормалізується:
- переводиться у нижній регістр,
- видаляються пробіли та розділові знаки,
- залишаються лише літери англійської і української мови та цифри.

Для перевірки використовується deque, що дозволяє ефективно
порівнювати символи з обох кінців.
"""

from collections import deque   # deque для двосторонньої черги
import re                       # модуль regex для очищення тексту


def normalize_text(text: str) -> str:
    """
    Нормалізує текст для перевірки паліндрому:

    1) Переводить у нижній регістр.
    2) Видаляє всі символи, крім:
       - латинських літер,
       - українських літер,
       - цифр.

    Повертає очищений рядок.
    """
    text = text.lower()  # приводимо текст до нижнього регістру

    # залишаємо тільки потрібні символи та цифри
    # діапазони:
    # a-z  -> латиниця
    # 0-9  -> цифри
    # а-я, ї, і, є, ґ -> українська літерація
    text = re.sub(r"[^a-z0-9а-щьюяєіїґ]", "", text)

    return text  # повертаємо нормалізований текст


def is_palindrome(text: str) -> bool:
    """
    Перевіряє, чи є рядок паліндромом.

    Алгоритм:
    1) Нормалізує текст (регістр/пробіли/пунктуація ігноруються).
    2) Додає символи в deque.
    3) Порівнює символи зліва і справа, доки deque не спорожніє або не лишиться 1 символ.
    4) Якщо знайдено невідповідність, то повертає False, інакше – True.
    """
    cleaned = normalize_text(text)   # очищуємо текст

    chars = deque(cleaned)      # створюємо deque з очищених символів

    while len(chars) > 1:       # допоки символів до порівняння більше 1
        left = chars.popleft()  # беремо перший символ зліва
        right = chars.pop()     # беремо останній символ справа

        if left != right:  # якщо не збігаються — не паліндром
            return False

    return True  # якщо всі пари збіглися — паліндром


if __name__ == "__main__":
    # тестові виклики
    print(is_palindrome("racecar"))  # True
    print(is_palindrome("hello"))    # False
    print(is_palindrome("A man, a plan, a canal: Panama"))  # True

    # кириличні приклади
    print(is_palindrome("Я несу гусеня"))  # True
    print(is_palindrome("Життя прекрасне!"))  # False
