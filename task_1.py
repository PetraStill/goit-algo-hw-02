"""
Програма моделює роботу сервісного центру обробки заявок:
- створює чергу заявок (FIFO) за допомогою Queue;
- автоматично генерує нові заявки з імовірністю 60% у кожному циклі;
- додає заявки до черги;
- послідовно обробляє першу заявку з черги;
- якщо черга порожня — виводить відповідне повідомлення;
- працює безперервно, доки користувач не зупинить її комбінацією Ctrl+C.
"""

import time              # імпортуємо модуль time для пауз і роботи з часом
import random            # імпортуємо модуль random для генерації випадковостей
from queue import Queue  # імпортуємо клас Queue для реалізації черги заявок

request_queue = Queue()  # створюємо чергу, куди будемо додавати заявки
next_request_id = 1      # створюємо лічильник для унікальних ідентифікаторів заявок


def generate_request():
    """
    Функція генерує (створює) нову заявку.

    Логіка роботи:
    1) Береться поточне значення next_request_id як унікальний номер.
    2) Створюється заявка у вигляді словника.
    3) Заявка додається в кінець черги.
    4) Лічильник збільшується, щоб наступна заявка мала інший номер.
    """
    global next_request_id              # дозволяємо змінювати глобальний лічильник всередині функції

    request = {"id": next_request_id}   # створюємо нову заявку з унікальним id
    request_queue.put(request)          # додаємо заявку до черги

    print(f"Заявка {request['id']} створена і додана до черги")  # повідомляємо про створення заявки
    next_request_id += 1                                         # збільшуємо лічильник для наступної заявки


def process_request():
    """
    Функція обробляє одну заявку з черги.

    Логіка роботи:
    1) Перевіряє, чи черга порожня.
    2) Якщо порожня, то виводить повідомлення.
    3) Якщо не порожня — дістає першу заявку (FIFO) та імітує її обробку.
    """
    if request_queue.empty():                     # перевіряємо, чи черга порожня
        print("Черга пуста.")                     # повідомляємо, що обробляти нічого
    else:
        request = request_queue.get()            # дістаємо першу заявку з черги
        print(f"Заявка {request['id']} обробляється.")  # імітуємо початок обробки
        time.sleep(random.uniform(0.3, 1.0))     # робимо випадкову паузу для імітації часу обробки


def main():
    """
    Головна функція програми з безперервним циклом.

    Логіка роботи:
    1) У кожному циклі з імовірністю 60% створюється нова заявка.
    2) Далі виконується обробка однієї заявки.
    3) Робиться випадкова пауза між циклами.
    4) Вихід — через Ctrl+C (KeyboardInterrupt).
    """
    try:
        while True:                                  # запускаємо нескінченний цикл роботи сервісного центру
            if random.random() < 0.6:                # перевіряємо шанс 60% на створення заявки
                generate_request()                   # якщо умова виконана, то генеруємо нову заявку

            process_request()                        # намагаємося обробити одну заявку
            time.sleep(random.uniform(0.5, 1.5))     # пауза між циклами для імітації реального потоку
    except KeyboardInterrupt:                        # перехоплюємо зупинку користувачем (Ctrl+C)
        print("\nПрограму зупинено користувачем.")   # виводимо повідомлення про завершення


if __name__ == "__main__":  # перевіряємо, що файл запущено напряму, а не імпортовано
    main()                  # запускаємо головну функцію
